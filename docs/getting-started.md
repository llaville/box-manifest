<!-- markdownlint-disable MD013 MD028 -->
# Getting Started

## Requirements

* PHP 8.1 or greater
* ext-phar
* PHPUnit 10 or greater (if you want to run unit tests)

## Docker

> v3.x docker images provided run in rootless mode, so you don't have to specify `-u $(id -u ${USER}):$(id -g ${USER})` options.

> Please mount the code directory to `/app` in the container.

Usage examples :

```shell
docker run --rm -it -v $(pwd):/app -w /app -e APP_DEBUG=false ghcr.io/llaville/box-manifest:v3 box-manifest -c box.json --output-file=manifest-sbom.xml
docker run --rm -it -v $(pwd):/app -w /app -e APP_DEBUG=false ghcr.io/llaville/box-manifest:v3 box-manifest -c box.json --output-file=manifest-manifest.txt
docker run --rm -it -v $(pwd):/app -w /app -e APP_DEBUG=false ghcr.io/llaville/box-manifest:v3 box-stub -c box.json --output-file=manifest-stub.php
docker run --rm -it -v $(pwd):/app -w /app -e APP_DEBUG=false ghcr.io/llaville/box-manifest:v3 box-compile -c box.json.dist

docker run --rm -it -v $(pwd):/app -w /app -e APP_DEBUG=false ghcr.io/llaville/box-manifest:v3 box-manifest --bootstrap tests/fixtures/my-manifest.php --format \\Bartlett\\BoxManifest\\Tests\\fixtures\\ConsoleManifest -v
```

## Usage

There are three binaries commands :

### Binary `box-manifest`

(Symfony `manifest:build` command) to build your application's manifest.

```text
Description:
  Creates a manifest of your software components and dependencies.

Usage:
  manifest:build [options]

Options:
      --no-config                Ignore the config file even when one is specified with the --config option
  -c, --config=CONFIG            The alternative configuration file path.
      --bootstrap=BOOTSTRAP      A PHP script that is included before execution
  -f, --format=FORMAT            Format of the output: auto, plain, ansi, sbom [default: "auto"]
  -s, --sbom-spec=SBOM-SPEC      SBOM specification version: 1.1, 1.2, 1.3, 1.4 [default: "1.4"]
  -o, --output-file=OUTPUT-FILE  Write results to file (default to standard output)
  -h, --help                     Display help for the given command. When no command is given display help for the manifest:build command
  -q, --quiet                    Do not output any message
  -V, --version                  Display this application version
      --ansi|--no-ansi           Force (or disable --no-ansi) ANSI output
  -n, --no-interaction           Do not ask any interactive question
  -e, --env=ENV                  The Environment name. [default: "dev"]
      --no-debug                 Switches off debug mode.
  -v|vv|vvv, --verbose           Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
  The manifest:build command will generate a manifest of your application.
```

The `--output-file` and `--format` options can be used to control the formatting and destination
of the output generated by `box-manifest`.
The default is to report to the console standard output but can be stored in a file (specified using `--output-file` option).
The format of the output can be changed using the `--format` option which may be useful if the output is to be used
as an input by another tool like `box`.

The `--config` option can be used to specify path to alternate version of a `box.json.dist` or `box.json`
that are not found in current working directory.

The `--no-config` option must be specified if you don't want to use BOX default configuration files (`box.json.dist` or `box.json`)

Once generated with the `--output-file` option, the manifest may be included as any other files you want to add into your PHP Archive.

### Binary `box-stub`

(Symfony `manifest:stub` command) to build the stub that will support `--manifest` option, to display its contents at runtime.

```text
Description:
  Generates a stub for your manifest application.

Usage:
  manifest:stub [options]

Options:
      --no-config                Ignore the config file even when one is specified with the --config option
  -c, --config=CONFIG            The alternative configuration file path.
  -o, --output-file=OUTPUT-FILE  Write results to file (default to standard output)
  -h, --help                     Display help for the given command. When no command is given display help for the manifest:stub command
  -q, --quiet                    Do not output any message
  -V, --version                  Display this application version
      --ansi|--no-ansi           Force (or disable --no-ansi) ANSI output
  -n, --no-interaction           Do not ask any interactive question
  -e, --env=ENV                  The Environment name. [default: "dev"]
      --no-debug                 Switches off debug mode.
  -v|vv|vvv, --verbose           Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
  The manifest:stub command will generate a stub of your manifest application.
```

The `--output-file` option can be used to control the destination of the output generated by `box-stub`.
The default is to report to the console standard output but can be stored in a file

The `--config` option can be used to specify path to alternate version of a `box.json.dist` or `box.json`
that are not found in current working directory.

The `--no-config` option must be specified if you don't want to use BOX default configuration files (`box.json.dist` or `box.json`)

### Binary `box-compile`

(Box `compile` command with `--bootstrap` option) to compile your PHAR application.

```text
Description:
  ðŸ”¨  Compiles an application into a PHAR

Usage:
  compile [options]

Options:
      --debug                         Dump the files added to the PHAR in a `.box_dump` directory
      --no-parallel                   Disable the parallel processing
      --no-restart                    Do not restart the PHP process. Box restarts the process by default to disable xdebug and set `phar.readonly=0`
      --dev                           Skips the compression step
      --no-config                     Ignore the config file even when one is specified with the --config option
      --with-docker                   Generates a Dockerfile
      --composer-bin=COMPOSER-BIN     Composer binary to use
      --allow-composer-check-failure  To continue even if an unsupported Composer version is detected
  -c, --config=CONFIG                 The alternative configuration file path.
  -d, --working-dir=WORKING-DIR       If specified, use the given directory as working directory.
      --bootstrap=BOOTSTRAP           A PHP script that is included before execution
  -h, --help                          Display help for the given command. When no command is given display help for the list command
  -q, --quiet                         Do not output any message
  -V, --version                       Display this application version
      --ansi|--no-ansi                Force (or disable --no-ansi) ANSI output
  -n, --no-interaction                Do not ask any interactive question
  -e, --env=ENV                       The Environment name. [default: "dev"]
      --no-debug                      Switches off debug mode.
  -v|vv|vvv, --verbose                Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
  The compile command will compile code in a new PHAR based on a variety of settings.

    This command relies on a configuration file for loading
    PHAR packaging settings. If a configuration file is not
    specified through the --config|-c option, one of
    the following files will be used (in order): box.json,
    box.json.dist

  The configuration file is actually a JSON object saved to a file. For more
  information check the documentation online:

    https://github.com/humbug/box
```

The `--bootstrap` option can be used to specify what PHP file to include at runtime. It's particular useful when you're callable
is not in the scope of your autoloader.

The `--config` option can be used to specify path to alternate version of a `box.json.dist` or `box.json`
that are not found in current working directory.

The `--no-config` option must be specified if you don't want to use BOX default configuration files (`box.json.dist` or `box.json`)

### Define the manifest in the `metadata` field of your PHP Archive

Like in previous versions  (1.x and 2.x), if you want to keep the manifest included in the metadata field of your PHAR,
then you must configure [`metadata`][metadata-directive] directive with a [PHP callable][php-callables].

E.g: See also the [tutorial](../examples/README.md) to learn more.

```json
{
  "metadata": "MyCallbacks::manifest"
}
```

**NOTE** if none of files (`manifest.txt`, `manifest.xml`, `sbom.xml`, `sbom.json`) are found, when you execute `box-compile` command,
then metadata field of your PHAR will contain NULL value (default BOX behavior).

[metadata-directive]: https://github.com/box-project/box/blob/main/doc/configuration.md#metadata-metadata
[php-callables]: https://www.php.net/manual/en/language.types.callable.php
