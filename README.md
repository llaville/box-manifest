<!-- markdownlint-disable MD013 MD033 -->
# BOX Manifest

Main goal of this project is to write a manifest in any [PHP Archive (PHAR)](https://www.php.net/phar)
built with the [BOX](https://github.com/box-project/box) tool.

## Limitation

The [Metadata (`metadata`)](https://github.com/box-project/box/blob/master/doc/configuration.md#metadata-metadata) setting
of the BOX allow only a callable function that will be evaluated without any arguments.

Currently, the BOX 4.0+ did not send contextual parameters (`KevinGH\Box\Configuration\Configuration` and `KevinGH\Box\Box`)
when calling the metadata callback.

This is the reason, why this project used [`cweagans/composer-patches`](https://github.com/cweagans/composer-patches)
composer plugin to patch `humbug/box` at install runtime.

## Documentation

All the documentation is available on [website](https://llaville.github.io/box-manifest/2.x),
generated from the [docs](https://github.com/llaville/box-manifest/tree/master/docs) folder.

* [Getting Started](docs/getting-started.md).

## Usage

When your metadata setting identify a callable function, this one is in charge
to call the `Bartlett\BoxManifest\Composer\ManifestFactory::create` function with any class or object that must implement
the `Bartlett\BoxManifest\Composer\ManifestBuilderInterface` interface.

Then proceed with the `bin/box` command to realize all BOX operations.

This project provide, by default, two basic implementations :

### Create a simple key-value pairs text format

```json
{
  "metadata": "Bartlett\\BoxManifest\\Composer\\ManifestFactory::toText"
}
```

<details>
<summary>box compile output</summary>

```text

    ____
   / __ )____  _  __
  / __  / __ \| |/_/
 / /_/ / /_/ />  <
/_____/\____/_/|_|


Box version 4.2.0@afc3a47

 // Loading the configuration file "/shared/backups/bartlett/box-manifest/box.json.dist".

ðŸ”¨  Building the PHAR "/shared/backups/bartlett/box-manifest/box-manifest.phar"

? No compactor to register
? Adding main file: /shared/backups/bartlett/box-manifest/bin/box
? Adding requirements checker
? Adding binary files
    > 24 file(s)
? Auto-discover files? No
? Exclude dev files? Yes
? Adding files
    > 3371 file(s)
? Generating new stub
  - Using shebang line: #!/usr/bin/env php
  - Using banner:
    > Generated by Humbug Box 4.2.0@afc3a47.
    >
    > @link https://github.com/humbug/box
? Setting metadata
  - Using composer.json : /shared/backups/bartlett/box-manifest/composer.json
  - Using composer.lock : /shared/backups/bartlett/box-manifest/composer.lock
  - bartlett/box-manifest: 2.x-dev
amphp/amp: v2.6.2
amphp/byte-stream: v1.8.1
amphp/parallel: v1.4.1
amphp/parallel-functions: v1.1.0
amphp/parser: v1.0.0
amphp/process: v1.1.4
amphp/serialization: v1.0.0
amphp/sync: v1.4.2
composer/ca-bundle: 1.3.4
composer/class-map-generator: 1.0.0
composer/composer: 2.4.4
composer/metadata-minifier: 1.0.0
composer/package-versions-deprecated: 1.11.99.5
composer/pcre: 3.1.0
composer/semver: 3.3.2
composer/spdx-licenses: 1.5.7
composer/xdebug-handler: 3.0.3
cweagans/composer-patches: 1.7.2
fidry/console: 0.5.3
humbug/box: 4.2.0
humbug/php-scoper: 0.17.7
jetbrains/phpstorm-stubs: v2022.2
justinrainbow/json-schema: 5.2.12
laravel/serializable-closure: v1.2.2
nikic/iter: v2.2.0
nikic/php-parser: v4.15.2
paragonie/constant_time_encoding: v2.6.3
paragonie/pharaoh: v0.6.0
phpdocumentor/reflection-common: 2.2.0
phpdocumentor/reflection-docblock: 5.3.0
phpdocumentor/type-resolver: 1.6.2
psr/container: 2.0.2
psr/event-dispatcher: 1.0.0
psr/log: 3.0.0
react/promise: v2.9.0
seld/jsonlint: 1.9.0
seld/phar-utils: 1.2.1
seld/signal-handler: 2.0.1
symfony/console: v6.1.7
symfony/deprecation-contracts: v3.1.1
symfony/event-dispatcher-contracts: v3.1.1
symfony/filesystem: v6.1.5
symfony/finder: v6.1.3
symfony/polyfill-ctype: v1.27.0
symfony/polyfill-intl-grapheme: v1.27.0
symfony/polyfill-intl-normalizer: v1.27.0
symfony/polyfill-mbstring: v1.27.0
symfony/process: v6.1.3
symfony/serializer: v6.1.6
symfony/service-contracts: v3.1.1
symfony/string: v6.1.7
symfony/var-dumper: v6.1.6
thecodingmachine/safe: v2.4.0
ulrichsg/getopt-php: v3.4.0
webmozart/assert: 1.11.0
? Dumping the Composer autoloader
? Removing the Composer dump artefacts
? Compressing with the algorithm "GZ"
    > Warning: the extension "zlib" will now be required to execute the PHAR
? Setting file permissions to 0755
* Done.

No recommendation found.
No warning found.

 // PHAR: 3418 files (7.70MB)
 // You can inspect the generated PHAR with the "info" command.

 // Memory usage: 71.03MB (peak: 71.90MB), time: 7secs
 ```

</details>

### Read information of the PHP Archive with BOX

For example : `box info /path/to/box-manifest.phar`

With a manifest in TEXT format

<details>
<summary>box info output</summary>

```text

API Version: 1.1.0

Compression: GZ

Signature: SHA-1
Signature Hash: 7F292D404DFB86EA7839A11C3F97879E2D432A75

Metadata:
'bartlett/box-manifest: 2.x-dev
amphp/amp: v2.6.2
amphp/byte-stream: v1.8.1
amphp/parallel: v1.4.1
amphp/parallel-functions: v1.1.0
amphp/parser: v1.0.0
amphp/process: v1.1.4
amphp/serialization: v1.0.0
amphp/sync: v1.4.2
composer/ca-bundle: 1.3.4
composer/class-map-generator: 1.0.0
composer/composer: 2.4.4
composer/metadata-minifier: 1.0.0
composer/package-versions-deprecated: 1.11.99.5
composer/pcre: 3.1.0
composer/semver: 3.3.2
composer/spdx-licenses: 1.5.7
composer/xdebug-handler: 3.0.3
cweagans/composer-patches: 1.7.2
fidry/console: 0.5.3
humbug/box: 4.2.0
humbug/php-scoper: 0.17.7
jetbrains/phpstorm-stubs: v2022.2
justinrainbow/json-schema: 5.2.12
laravel/serializable-closure: v1.2.2
nikic/iter: v2.2.0
nikic/php-parser: v4.15.2
paragonie/constant_time_encoding: v2.6.3
paragonie/pharaoh: v0.6.0
phpdocumentor/reflection-common: 2.2.0
phpdocumentor/reflection-docblock: 5.3.0
phpdocumentor/type-resolver: 1.6.2
psr/container: 2.0.2
psr/event-dispatcher: 1.0.0
psr/log: 3.0.0
react/promise: v2.9.0
seld/jsonlint: 1.9.0
seld/phar-utils: 1.2.1
seld/signal-handler: 2.0.1
symfony/console: v6.1.7
symfony/deprecation-contracts: v3.1.1
symfony/event-dispatcher-contracts: v3.1.1
symfony/filesystem: v6.1.5
symfony/finder: v6.1.3
symfony/polyfill-ctype: v1.27.0
symfony/polyfill-intl-grapheme: v1.27.0
symfony/polyfill-intl-normalizer: v1.27.0
symfony/polyfill-mbstring: v1.27.0
symfony/process: v6.1.3
symfony/serializer: v6.1.6
symfony/service-contracts: v3.1.1
symfony/string: v6.1.7
symfony/var-dumper: v6.1.6
thecodingmachine/safe: v2.4.0
ulrichsg/getopt-php: v3.4.0
webmozart/assert: 1.11.0'

Contents: 3418 files (7.70MB)

 // Use the --list|-l option to list the content of the PHAR.

```

</details>

## Contributors

* Laurent Laville (Lead Developer)
